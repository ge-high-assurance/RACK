{
  "variables": {
    "http_proxy": "{{env `http_proxy`}}",
    "https_proxy": "{{env `https_proxy`}}",
    "no_proxy": "{{env `no_proxy`}}",
    "repository": "gehighassurance/rack-box",
    "tags": "{{user `version`}}",
    "version": "dev"
  },

  "builders": [
    {
      "name": "arch_amd64",
      "type": "docker",
      "changes": [
        "ENTRYPOINT [ \"/usr/bin/python3\", \"/usr/bin/systemctl\" ]"
      ],
      "commit": true,
      "image": "ubuntu:22.04",
      "platform": "linux/amd64",
      "pull": false
    },
    {
      "name": "arch_arm64v8",
      "type": "docker",
      "changes": [
        "ENTRYPOINT [ \"/usr/bin/python3\", \"/usr/bin/systemctl\" ]"
      ],
      "commit": true,
      "image": "ubuntu:22.04",
      "platform": "linux/arm64/v8",
      "pull": true
    }
  ],

  "provisioners": [
    {
      "type": "file",
      "source": "./files",
      "destination": "/tmp"
    },
    {
      "type": "shell",
      "scripts": [
        "scripts/install.sh",
        "scripts/clean.sh"
      ],
      "environment_vars": [
        "http_proxy={{user `http_proxy`}}",
        "https_proxy={{user `https_proxy`}}",
        "no_proxy={{user `no_proxy`}}"
      ]
    }
  ],

  "post-processors": [
    [
      {
        "type": "docker-tag",
        "repository": "{{user `repository`}}",
        "tags": "{{user `tags`}}"
      }
    ]
  ]
}
